<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retinal Age Gap - Research Use Only</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="banner">
        ⚠️ Research / Investigational Use Only | Model trained on healthy eyes | Not validated for external data | Not a
        diagnostic device
    </div>

    <div class="container">
        <header>
            <h1>Retinal Age Gap</h1>
            <p class="subtitle">WCM Oph Research</p>
        </header>

        <!-- Step 1: Prediction -->
        <section id="prediction-section" class="card">
            <h2>Step 1: Predict Retinal Age</h2>
            <form id="predict-form">
                <div class="form-group">
                    <label for="fundus-image">Fundus Image (PNG/JPG)</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="fundus-image" name="file" accept="image/png, image/jpeg" required>
                        <div class="file-upload-placeholder">Click to upload or drag and drop</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Laterality</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="laterality" value="OD" required>
                            OD (Right)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="laterality" value="OS" required>
                            OS (Left)
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="predict-btn">Predict Retinal Age</button>
            </form>

            <div id="loading-spinner" class="hidden">
                <div class="spinner"></div>
                <p>Processing image...</p>
            </div>
        </section>

        <!-- Results Panel -->
        <section id="results-section" class="card hidden">
            <h2>Prediction Results</h2>

            <div class="result-row">
                <div class="result-item">
                    <span class="label">Predicted Retinal Age</span>
                    <span class="value" id="predicted-age">--</span>
                    <span class="unit">years</span>
                    <div class="recalibration-note">Recalibrated for improved accuracy</div>
                </div>
                <div class="result-item">
                    <span class="label">QC Status</span>
                    <span class="value" id="qc-status">--</span>
                </div>
            </div>

            <div id="qc-details" class="qc-details hidden">
                <p><strong>QC Issues:</strong> <span id="qc-reasons"></span></p>
            </div>

            <div class="meta-info">
                <small>Model: <span id="model-version"></span> | App: <span id="app-version"></span></small>
            </div>

            <button type="button" class="btn-text start-over-btn">← Start Over</button>
        </section>

        <!-- Step 2: Age Gap -->
        <section id="gap-section" class="card hidden">
            <h2>Step 2: Compute Retinal Age Gap</h2>
            <form id="gap-form">
                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" min="1900-01-01" max="2026-01-04" required>
                    <small class="form-help">Tip: Click the year in the picker to change it quickly.</small>
                </div>
                <button type="submit" class="btn-secondary">Compute Retinal Age Gap</button>
            </form>

            <div id="gap-results" class="gap-results hidden">
                <div class="result-row">
                    <div class="result-item">
                        <span class="label">Chronological Age</span>
                        <span class="value" id="chrono-age">--</span>
                        <span class="unit">years</span>
                    </div>
                    <div class="result-item highlight">
                        <span class="label">Retinal Age Gap</span>
                        <span class="value" id="age-gap">--</span>
                        <span class="unit">years</span>
                    </div>
                </div>
                <button type="button" class="btn-text start-over-btn">← Start Over</button>
            </div>
        </section>

        <!-- About Section -->
        <section id="about-section" class="card">
            <h2>About This Tool</h2>
            <div class="about-content">
                <p><strong>Retinal Age Gap (JOIR Model)</strong></p>
                <p>This web application estimates retinal age from fundus photographs using a deep learning model
                    developed by the Japan Ophthalmological Society, the Japan Ocular Imaging Registry (JOIR), and the
                    National Institute of Informatics (NII). After retinal age is predicted, users may optionally enter
                    date of birth to compute a retinal age gap, defined as:</p>
                <p class="formula">Retinal Age Gap = Predicted Retinal Age − Chronological Age</p>

                <div class="recalibration-info">
                    <p><strong>Population-Specific Recalibration:</strong></p>
                    <p>Based on our evaluation of the ODIR-5K dataset (Chinese population), the original JOIR model
                        showed a systematic overestimation bias. To improve accuracy, we have applied a linear
                        recalibration as the baseline:</p>
                    <p class="formula">Recalibrated Age = (0.3582 × Raw Model Output) + 33.8793</p>
                </div>

                <p>This tool is intended for ophthalmic research and methodological exploration only. It is not a
                    diagnostic device and should not be used for clinical decision-making.</p>

                <h3>Model Provenance and Citation</h3>
                <p>The retinal age estimation model is a publicly released JOIR model trained on fundus images collected
                    from health checkup facilities in Japan.</p>
                <p><strong>Required citation:</strong><br>
                    Miyake M, Akiyama M, Kashiwagi K, Sakamoto T, Oshika T. Japan Ocular Imaging Registry: a national
                    ophthalmology real-world database. Japanese Journal of Ophthalmology. 2022;66(6):499–503.
                    doi:10.1007/s10384-022-00941-0.</p>

                <h3>Training Data and Model Characteristics</h3>
                <ul>
                    <li><strong>Training dataset:</strong> 12,734 fundus images from 12,734 individuals</li>
                    <li><strong>Population:</strong> Healthy eyes only</li>
                    <li><strong>Age range:</strong> 18–84 years (mean ~42 years)</li>
                    <li><strong>Healthy definition:</strong> No significant medical history, normal cardio-ankle
                        vascular index, and blood pressure &lt;140/90 mmHg</li>
                    <li><strong>Architecture:</strong> Swin Transformer (transfer learning from ImageNet)</li>
                    <li><strong>Input size:</strong> 384 × 384 RGB</li>
                    <li><strong>Output:</strong> Continuous age prediction (years)</li>
                    <li><strong>Reported internal performance:</strong> Mean absolute error ≈ 2.39 years on held-out
                        test data</li>
                </ul>
            </div>
        </section>
    </div>

    <script src="/static/script.js"></script>
</body>

</html>